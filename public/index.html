<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SillyTavern å¤šå¼€ç®¡ç†å¹³å°</title>
    <link rel="stylesheet" href="/css/style.css">
    <!-- é¢„åŠ è½½æ ·å¼ï¼Œé˜²æ­¢é—ªçƒ -->
    <style>
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            transition: opacity 0.3s ease-out;
        }
        
        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 5px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* éšè—å†…å®¹ç›´åˆ°åŠ è½½å®Œæˆ */
        .content-wrapper {
            opacity: 0;
            transition: opacity 0.3s ease-in;
        }
        
        .content-loaded .content-wrapper {
            opacity: 1;
        }
        
        .content-loaded .loading-overlay {
            opacity: 0;
            pointer-events: none;
        }
        
        /* å°å‹åŠ è½½åŠ¨ç”» */
        .loading-spinner-small {
            display: inline-block;
            width: 12px;
            height: 12px;
            border: 2px solid rgba(113, 128, 150, 0.3);
            border-radius: 50%;
            border-top-color: #718096;
            animation: spin 1s ease-in-out infinite;
            margin-right: 5px;
            vertical-align: middle;
        }
    </style>
    <!-- åœ¨headä¸­é¢„åŠ è½½ç«™ç‚¹è®¾ç½® -->
    <script>
        window.siteSettings = {
            loaded: false,
            data: null
        };
    </script>
</head>
<body>
    <!-- åŠ è½½å åŠ å±‚ -->
    <div class="loading-overlay">
        <div class="loading-spinner"></div>
    </div>
    
    <!-- å†…å®¹åŒ…è£…å™¨ -->
    <div class="content-wrapper">
    <div class="container">
        <div class="auth-card">
            <div class="logo">
                <div style="text-align: center; margin-bottom: 10px;">
                    <img src="/logo.png" alt="Logo" style="max-width: 120px; height: auto;" class="site-logo">
                </div>
                <h1 class="site-name">SillyTavern</h1>
                <p class="subtitle">å¤šå¼€ç®¡ç†å¹³å°</p>
            </div>

            <!-- å…¬å‘Šè½®æ’­åŒºåŸŸ -->
            <div id="announcementContainer" style="display: none; margin-bottom: 20px; position: relative;">
                <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 8px; padding: 15px; color: white; position: relative;">
                    <h3 style="margin: 0 0 10px 0; font-size: 16px; display: flex; align-items: center; gap: 8px;">
                        ğŸ“¢ <span id="announcementTitle"></span>
                    </h3>
                    <p id="announcementContent" style="margin: 0; line-height: 1.6; font-size: 14px; white-space: pre-wrap;"></p>
                    <small id="announcementDate" style="display: block; margin-top: 10px; opacity: 0.8; font-size: 12px;"></small>
                    
                    <!-- è½®æ’­æ§åˆ¶ -->
                    <div id="announcementControls" style="display: none; margin-top: 15px; display: flex; align-items: center; justify-content: space-between;">
                        <button onclick="prevAnnouncement()" style="background: rgba(255,255,255,0.2); border: none; color: white; padding: 5px 15px; border-radius: 5px; cursor: pointer; font-size: 18px;">â®</button>
                        <div id="announcementIndicators" style="display: flex; gap: 8px;"></div>
                        <button onclick="nextAnnouncement()" style="background: rgba(255,255,255,0.2); border: none; color: white; padding: 5px 15px; border-radius: 5px; cursor: pointer; font-size: 18px;">â¯</button>
                    </div>
                </div>
            </div>

            <!-- ç™»å½•è¡¨å• -->
            <div id="loginForm" class="form-container active">
                <h2>ç™»å½•</h2>
                <form onsubmit="handleLogin(event)">
                    <div class="form-group modern-input">
                        <div class="input-container username-container styled-input">
                            <span class="input-icon user-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.75" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                                    <circle cx="12" cy="7" r="4"></circle>
                                </svg>
                            </span>
                            <input type="text" id="loginUsername" name="username" placeholder="è¯·è¾“å…¥è´¦å·" required>
                        </div>
                    </div>
                    <div class="form-group modern-input">
                        <div class="input-container password-container styled-input">
                            <span class="input-icon lock-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.75" stroke-linecap="round" stroke-linejoin="round">
                                    <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                                    <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                                </svg>
                            </span>
                            <input type="password" id="loginPassword" name="password" placeholder="è¯·è¾“å…¥å¯†ç " required>
                            <span class="password-toggle" onclick="togglePasswordVisibility('loginPassword', this)">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.75" stroke-linecap="round" stroke-linejoin="round" class="eye-icon">
                                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                    <circle cx="12" cy="12" r="3"></circle>
                                </svg>
                            </span>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary">ç™»å½•</button>
                </form>
                <p class="switch-form">
                    è¿˜æ²¡æœ‰è´¦å·ï¼Ÿ <a href="#" onclick="switchToRegister()">ç«‹å³æ³¨å†Œ</a>
                </p>
            </div>

            <!-- æ³¨å†Œè¡¨å• -->
            <div id="registerForm" class="form-container">
                <h2>æ³¨å†Œ</h2>
                <form onsubmit="handleRegister(event)">
                    <div class="form-group modern-input">
                        <div class="input-container username-container styled-input">
                            <span class="input-icon user-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.75" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                                    <circle cx="12" cy="7" r="4"></circle>
                                </svg>
                            </span>
                            <input type="text" id="registerUsername" name="username" required 
                                  placeholder="è¯·è¾“å…¥QQè´¦å·" minlength="5" maxlength="13" pattern="[0-9]+" oninput="updateQQAvatar()">
                        </div>
                        <small class="form-tip">
                            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="12" cy="12" r="10"></circle>
                                <path d="M12 8v4"></path>
                                <path d="M12 16h.01"></path>
                            </svg>
                            5-13ä¸ªå­—ç¬¦ï¼Œä»…é™æ•°å­—
                        </small>
                    </div>
                    <!-- QQå¤´åƒé¢„è§ˆ -->
                    <div class="form-group" style="display: flex; flex-direction: column; align-items: center; margin-bottom: 20px;">
                        <div id="qqAvatarContainer" style="display: none; margin-top: 10px;">
                            <img id="qqAvatar" src="" alt="QQå¤´åƒ" style="width: 80px; height: 80px; border-radius: 50%; border: 2px solid #667eea; box-shadow: 0 3px 10px rgba(0,0,0,0.15);">
                        </div>
                    </div>
                    <div class="form-group modern-input">
                        <div class="input-container password-container styled-input">
                            <span class="input-icon lock-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.75" stroke-linecap="round" stroke-linejoin="round">
                                    <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                                    <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                                </svg>
                            </span>
                            <input type="password" id="registerPassword" name="password" placeholder="è¯·è¾“å…¥å¯†ç " required minlength="6">
                            <span class="password-toggle" onclick="togglePasswordVisibility('registerPassword', this)">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.75" stroke-linecap="round" stroke-linejoin="round" class="eye-icon">
                                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                    <circle cx="12" cy="12" r="3"></circle>
                                </svg>
                            </span>
                        </div>
                        <small class="form-tip">
                            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="12" cy="12" r="10"></circle>
                                <path d="M12 8v4"></path>
                                <path d="M12 16h.01"></path>
                            </svg>
                            è‡³å°‘6ä¸ªå­—ç¬¦
                        </small>
                    </div>
                    <div class="form-group modern-input">
                        <div class="input-container password-container styled-input">
                            <span class="input-icon lock-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.75" stroke-linecap="round" stroke-linejoin="round">
                                    <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                                    <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                                </svg>
                            </span>
                            <input type="password" id="registerPasswordConfirm" name="passwordConfirm" placeholder="è¯·å†æ¬¡è¾“å…¥å¯†ç " required>
                            <span class="password-toggle" onclick="togglePasswordVisibility('registerPasswordConfirm', this)">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.75" stroke-linecap="round" stroke-linejoin="round" class="eye-icon">
                                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                    <circle cx="12" cy="12" r="3"></circle>
                                </svg>
                            </span>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary">æ³¨å†Œ</button>
                </form>
                <p class="switch-form">
                    å·²æœ‰è´¦å·ï¼Ÿ <a href="#" onclick="switchToLogin()">ç«‹å³ç™»å½•</a>
                </p>
            </div>

            <div id="message" class="message"></div>
            
            <!-- ç”¨æˆ·ç»Ÿè®¡ä¿¡æ¯ -->
            <div id="userStatsContainer" class="user-stats-container" style="margin-top: 20px; text-align: center; font-size: 14px; color: #4a5568; border-top: 1px solid #e2e8f0; background-color: #f7fafc; padding: 12px 15px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); margin-bottom: 15px; border: 1px solid #e2e8f0;">
                <h3 style="margin: 0 0 10px 0; font-size: 15px; color: #2d3748; font-weight: 600;">ç”¨æˆ·æ³¨å†ŒçŠ¶æ€</h3>
                <div id="userStatsInfo" style="font-weight: 500;">
                    å½“å‰æ³¨å†Œç”¨æˆ·: <span id="userCount" style="font-weight: 600; font-size: 16px; color: #3182ce;">0</span> / <span id="maxUsers" style="font-weight: 600; font-size: 16px; color: #3182ce;">0</span> ä½
                    <div style="margin-top: 8px;">
                        <span id="registrationStatus" style="display: inline-block; margin-top: 5px; font-size: 13px; background-color: #e6fffa; padding: 3px 10px; border-radius: 20px; border: 1px solid #b2f5ea; font-weight: 500;">âœ”ï¸ å¯æ³¨å†Œ</span>
                    </div>
                </div>
                <div id="userStatsLoading" style="display: none; padding: 10px 0;">
                    <span class="loading-spinner-small"></span> åŠ è½½ç”¨æˆ·æ•°æ®ä¸­...
                </div>
            </div>
            
            <!-- å‹æƒ…é“¾æ¥åŒºåŸŸ -->
            <div id="friendsLinksContainer" class="friends-links-container" style="display: none;">
                <h3>å‹æƒ…é“¾æ¥</h3>
                <div id="friendsLinks" class="friends-links"></div>
            </div>
        </div>
    </div>
    </div> <!-- å†…å®¹åŒ…è£…å™¨ç»“æŸ -->

    <script src="/js/auth.js"></script>
    <script src="/js/apply-site-settings.js"></script>
    
    <!-- ç¡®ä¿ç”¨æˆ·ç»Ÿè®¡ä¿¡æ¯æ˜¾ç¤º -->
    <script>
        // ç›´æ¥å°†ç”¨æˆ·ç»Ÿè®¡å®¹å™¨è®¾ç½®ä¸ºå¯è§
        document.getElementById('userStatsContainer').style.display = 'block';
        
        // æ·»åŠ å»¶è¿ŸåŠ è½½ï¼Œç¡®ä¿ API å¯ç”¨
        setTimeout(function() {
            if (typeof loadUserStats === 'function') {
                loadUserStats();
            }
        }, 500);
    </script>
    <script src="/js/fix-site-settings.js"></script>
    <script src="/js/friends-links.js"></script>
</body>
</html>
