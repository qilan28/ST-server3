# SillyTavern 自动跳转流程测试

## 🔄 新的用户体验流程

### 场景 1：用户首次注册
1. 用户注册 → `stSetupStatus: 'pending'`
2. 登录后访问控制台 → **自动跳转到版本选择页面** ✅
3. 用户选择版本安装 → 完成后回到控制台

### 场景 2：用户ST目录被删除
1. 用户之前已安装 → `stSetupStatus: 'completed'`
2. ST目录被手动删除 → `stDirectoryExists: false`
3. 访问控制台 → API检查发现目录不存在 → **自动跳转到版本选择页面** ✅

### 场景 3：安装失败的用户
1. 用户安装过程中失败 → `stSetupStatus: 'failed'`
2. 访问控制台 → **自动跳转到版本选择页面** ✅

### 场景 4：正常用户
1. 用户已正确安装 → `stSetupStatus: 'completed'` + `stDirectoryExists: true`
2. 访问控制台 → **正常显示控制台页面** ✅

## 🎯 改进效果

**之前的体验：**
```
用户访问控制台 → 看到错误页面 → 点击警告按钮 → 跳转安装页面
```

**现在的体验：**
```
用户访问控制台 → 自动检测 → 直接跳转安装页面 → 完成安装后正常使用
```

## 🚀 跳转条件

系统会在以下情况自动跳转到版本选择页面：

1. **首次用户** - `stSetupStatus === 'pending'`
2. **安装失败** - `stSetupStatus === 'failed'`  
3. **目录丢失** - `stSetupStatus === 'completed'` 但 `stDirectoryExists === false`

## 📱 用户界面提示

跳转时会显示：
- 提示消息："检测到需要安装或重新安装 SillyTavern，正在跳转到版本选择页面..."
- 页面内容变为半透明且不可点击
- 2秒后自动跳转

## ⚡ 技术实现

- **后端检查**：`/api/instance/info` 自动检查ST目录存在性
- **前端检测**：`loadUserInfo()` 在页面初始化时就执行检查
- **智能跳转**：根据用户状态决定是否需要跳转
- **状态同步**：目录不存在时自动更新数据库状态为failed

这样的改进让整个用户流程更加顺畅！🎉
